<?php
if (! $this->getUser ()->isConnected ()) {
	echo 'Non connecté';
} else {
	?>
<!-- DEBUT: Profil -->
<script>
			function uploadProfilImage() {
				var input = document.getElementById('input_image_profil');
				if (input.files.length < 1) {
					toast('Veuillez selectionner une image.', 0)
					return ;
				}

                requestAPI('/user/account/image/set/',
                	{
	                    200: function(response) {
	                        toast('Votre image a bien été uploadé :) ' + response, 2);
	                    },
	                    400: function(response) {
	                    	toast('Vous êtes deconnecté. Veuillez vous reconnecter au site...', 0)
                    	}
                	},

                	{
                		'image': input.files[0]
                	}
                );
			}

			function sendResetToken() {
				var mail = "<?php echo $this->getUser()->getMail() ?>";
                requestAPI('/user/account/password/reset/',
                    	{
    	                    200: function(response) {
    	                        toast("Le token a été généré et envoyé par mail à l'adresse <strong>" + mail + "</strong>", "fine");
    	                    },
    	                    400: function(response) {
    	                    	toast("Erreur dans la requete", "error")
                        	},
                        	503: function(response) {
                            	toast("Erreur serveur. Veuillez contacter un administrateur.", "error");
                        	}
                    	},

                    	{
                    		'mail': mail
                    	}
                    );
			}
		</script>

<h1>Salut <?php echo $this->getUser()->getPseudo();?></h1>
<div class="text-capitalize">Modifier votre image de profil:</div>
<div class="button" style="margin-top: 1.5rem;">
<input type="file" accept="image/*" id="input_image_profil">
</div>
<input class="valide-button" type="submit" value="Envoyer" name="submit" onclick="uploadProfilImage();">
<br></br>
<div>
	Changer mon mot de passe:
	<button class="valide-button">Envoyer mail de réintialisation</button>
</div>

<!-- FIN: Profil -->


<!-- DEBUT : League of Legends -->
<script>
			function regenerateCode() {
                requestAPI('/user/game/lol/third-party-code/generate/', {
	                    200: function(response) {
	                        toast('Code regénéré: ' + response, 2);
	                        document.getElementById("code").value = response;
	                    },
	                    400: function(response) {
	                    	toast('Vous êtes deconnecté. Veuillez vous reconnecter au site...', 0)
                    	}
                	}
                );
			}
			regenerateCode();

			function verificateCode() {
				var summonerName = document.getElementById('summoner_name').value;
				requestAPI('/user/game/lol/third-party-code/link/',
	                {
	                    200: 	function(response) {
	                        		toast("Le nom d'invocateur '" + summonerName + "' est maintenant lié à votre compte!");
	                    		},

	                    400: 	function(response) {
	                    			toast("Le nom d'invocateur '" + summonerName + "' ne semble pas exister: " + response, 0)
	                    		}
	                },

					{
						'summonerName': summonerName
					}
                );
			}

			function copyCode() {
				var copyText = document.getElementById("code");
				copyText.select();
				document.execCommand("Copy");
				toast("Code copié " + copyText.value, 2);
			}
            function updateAccountsList() {
                requestAPI("/user/game/lol/accounts/get/",
                    {
                        200: 	function(response) {
                            //supprimes les invocateurs précèdents
                            while (node_notifications_list.firstChild) {
                                node_notifications_list.removeChild(node_notifications_list.firstChild);
                            }
                            //ajoutes les nouveaux invocateurs
                            var summoners = JSON.parse(response);
                            var node_list = document.getElementById("lol_accounts");
                            console.log(summoners);
                            for (var i in summoners) {
                                var summoner = summoners[i];
                                var node_summoner = document.createElement("li");
                                var node_summoner_icon = document.createElement("img");
                                node_summoner_icon.style.maxWidth = "2rem";
                                node_summoner_icon.style.minWidth = "2rem";
                                node_summoner_icon.src = "http://ddragon.leagueoflegends.com/cdn/8.9.1/img/profileicon/" + summoner.profileIconId  + ".png";
                                var node_summoner_name = document.createElement("span");
                                node_summoner_name.innerHTML = summoner.name;
                                node_summoner.appendChild(node_summoner_icon);
                                node_summoner.appendChild(node_summoner_name);
                                node_list.appendChild(node_summoner);
                            }
                        },
                        400: 	function(response) {
                            toast("Impossible de récuperer la liste des comptes League of Legends liés...", "error");
                        }
                    }
                );
            }
            updateAccountsList();
		</script>

<style>
.code {
	cursor: pointer;
}
</style>

<h1>
	<img src="./res/images/lol.png" alt="LOL" width="35" height="35" />
	League of Legends
</h1>

<h3>Liste des comptes liées:</h3>
<ul id="lol_accounts"></ul>
<div>Veuillez entrer votre pseudo League of Legends, puis entrez le code dans votre client:</div>
<input id="summoner_name"></input>
<input type="text" id="code" class="code" onclick="copyCode();" readonly></input>
<button style="cursor: pointer;" onclick="verificateCode();">Lier les comptes</button>

<!-- FIN : League of Legends -->



    <!-- DEBUT : PUBG -->
    <script>

        function getFullStats() {
            var summonerName = document.getElementById('summoner_name').value;
            var regions = document.getElementById('Regions').value;
            var mode = document.getElementById('Modes').value;
           print("Le nom "+summonerName+"  "+regions+"  "+mode );
        }
        function getProfileByNickname() {
            var nickname=document.getElementById('summoner_name').value;
            const playerName = encodeURIComponent(String(nickname).toLowerCase().replace(/\s/g, ''));
            const uri = `https://pubgtracker.com/api/profile/pc/${playerName}`;

            return this.handleCache(uri).then((content) => new Profile(content));
        }
    </script>

    <style>
        .code {
            cursor: pointer;
        }
    </style>

    <h1>
        <img src="./res/images/pubg.png" alt="PUBG" width="40" height="40" />
        PLAYERUNKNOWN'S BATTLEGROUNDS
    </h1>

    <h3>Liste des comptes liées:</h3>
    <ul id="pubg_accounts"></ul>
    <div>Veuillez entrer votre pseudo PLAYERUNKNOWN'S BATTLEGROUNDS :</div>
    <form>
        Pseudo: <input id="summoner_name"></input>
        Mode: <input id="Modes"  list="Modes_list" name="link1" />
        <datalist id="Modes_list">
            <option label="SOLO" value="solo" />
            <option label="DUO" value="duo" />
            <option label="SQUAD" value="squad" />
            <option label="SOLO-FPP" value="solo-fpp" />
            <option label="DUO-FPP" value="duo-fpp" />
            <option label="SQUAD-FPP" value="squad-fpp" />
        </datalist>
        Regions: <input id="Regions"  list="Regions_list" name="link2" />
    <datalist id="Regions_list">
        <option label="North America" value="na" />
        <option label="Europe" value="eu" />
        <option label="Asia" value="as" />
        <option label="Southeast Asia" value="sea" />
        <option label="South America" value="sa" />
        <option label="Oceania" value="oc" />
    </datalist>
    <button style="cursor: pointer;" onclick="getProfileByNickname();">Submit</button>
    </form>

    <!-- FIN : PUBG -->



<?php
} // If connected
?>

