<?php
		if (!$this->getUser()->isConnected()) {
			echo 'Non connecté';
			return ;

		}
?>



		<!-- DEBUT: Profil -->
		<script>
			function uploadProfilImage() {
				var input = document.getElementById('input_image_profil');
				if (input.files.length < 1) {
					toast('Veuillez selectionner une image.', 0)
					return ;
				}

                requestAPI('/user/account/image/set/',
                	{
	                    200: function(response) {
	                        toast('Votre image a bien été uploadé :) ' + response, 2);
	                    },
	                    400: function(response) {
	                    	toast('Vous êtes deconnecté. Veuillez vous reconnecter au site...', 0)
                    	}
                	},

                	{
                		'image': input.files[0]
                	}
                );
			}
		</script>
        <?php
        $Pseudo=$this->getUser()->asJoueur()->getPseudo();
        echo "<h1>Salut , $Pseudo !</h1>"
        ?>
    	<div class="text-capitalize">Modifier votre image de profil:</div>
        <div class="button" style="margin-top: 1.5rem;">
            <input type="file" accept="image/*" id="input_image_profil"></div>
	    <input class="valide-button" type="submit" value="Envoyer" name="submit" onclick="uploadProfilImage();">

		<br></br>
		<div>Changer mon mot de passe: <button  class="valide-button">Envoyer mail de réintialisation</button></div>

		<!-- FIN: Profil -->


		<!-- DEBUT : League of Legends -->
		<script>
			function regenerateCode() {
                requestAPI('/user/game/lol/third-party-code/generate/', {
	                    200: function(response) {
	                        toast('Code regénéré: ' + response, 2);
	                        document.getElementById("code").value = response;
	                    },
	                    400: function(response) {
	                    	toast('Vous êtes deconnecté. Veuillez vous reconnecter au site...', 0)
                    	}
                	}
                );
			}
			regenerateCode();

			function verificateCode() {
				var summonerName = document.getElementById('summoner_name').value;
				requestAPI('/user/game/lol/third-party-code/link/',
	                {
	                    200: 	function(response) {
	                        		toast("Le nom d'invocateur '" + summonerName + "' est maintenant lié à votre compte!");
	                    		},

	                    400: 	function(response) {
	                    			toast("Le nom d'invocateur '" + summonerName + "' ne semble pas exister: " + response, 0)
	                    		}
	                },

					{
						'summonerName': summonerName
					}
                );
			}

			function copyCode() {
				var copyText = document.getElementById("code");
				copyText.select();
				document.execCommand("Copy");
				toast("Code copié " + copyText.value, 2);
			}
            function updateAccountsList() {
                requestAPI("/user/game/lol/accounts/get/",
                    {
                        200: 	function(response) {
                            //supprimes les invocateurs précèdents
                            while (node_notifications_list.firstChild) {
                                node_notifications_list.removeChild(node_notifications_list.firstChild);
                            }
                            //ajoutes les nouveaux invocateurs
                            var summoners = JSON.parse(response);
                            var node_list = document.getElementById("lol_accounts");
                            console.log(summoners);
                            for (var i in summoners) {
                                var summoner = summoners[i];
                                var node_summoner = document.createElement("li");
                                var node_summoner_icon = document.createElement("img");
                                node_summoner_icon.style.maxWidth = "2rem";
                                node_summoner_icon.style.minWidth = "2rem";
                                node_summoner_icon.src = "http://ddragon.leagueoflegends.com/cdn/8.9.1/img/profileicon/" + summoner.profileIconId  + ".png";
                                var node_summoner_name = document.createElement("span");
                                node_summoner_name.innerHTML = summoner.name;
                                node_summoner.appendChild(node_summoner_icon);
                                node_summoner.appendChild(node_summoner_name);
                                node_list.appendChild(node_summoner);
                            }
                        },
                        400: 	function(response) {
                            toast("Impossible de récuperer la liste des comptes League of Legends liés...", "error");
                        }
                    }
                );
            }
            updateAccountsList();
		</script>

		<style>
			.code {
				cursor: pointer;
			}
		</style>

		<h1> <img src="./res/images/lol.png" alt="LOL" width="35" height="35"/>  League of Legends</h1>

<h3>Liste des comptes liées:</h3>
<ul id="lol_accounts"></ul>
<div>Veuillez entrer votre pseudo League of Legends, puis entrez le code
    dans votre client:</div>
        <div class="prompt">
            <input id="summoner_name" ></input></div>
		<input class="prompt" type="text" id="code" class="code" onclick="copyCode();" readonly></input>
        <div class="button">
            <button style="cursor: pointer;" onclick="verificateCode();">Lier les comptes</button>
        </div>

		<!-- FIN : League of Legends -->
